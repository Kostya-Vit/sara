<!DOCTYPE html>
<html lang="uk">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
		/>
		<title>–£—á–∞—Å–Ω–∏–∫ | –ü–µ—Ä–µ–≥–ª—è–¥ –¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó</title>
		<style>
			/* === –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò === */
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
				background: #0f172a;
				color: white;
				/* –£–ë–†–ê–ù–û: min-height: 100vh; - —ç—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π */
				display: flex;
				flex-direction: column;
				/* –î–æ–±–∞–≤–ª—è–µ–º fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ */
				min-height: 100vh;
			}

			/* === –®–ê–ü–ö–ê –¢–û–õ–¨–ö–û –ù–ê –î–ï–°–ö–¢–û–ü–ï === */
			.desktop-header {
				display: none;
				background: rgba(30, 41, 59, 0.95);
				padding: 1rem 2rem;
				border-bottom: 1px solid rgba(255, 255, 255, 0.1);
			}

			.header-content {
				max-width: 1200px;
				margin: 0 auto;
				display: flex;
				justify-content: space-between;
				align-items: center;
				width: 100%;
			}

			.header-title {
				display: flex;
				align-items: center;
				gap: 0.75rem;
			}

			.room-id-display {
				background: rgba(255, 255, 255, 0.1);
				padding: 0.5rem 1rem;
				border-radius: 8px;
				font-family: monospace;
				font-size: 0.9rem;
			}

			/* === –ú–û–ë–ò–õ–¨–ù–ê–Ø –®–ê–ü–ö–ê === */
			.mobile-header {
				display: none;
				background: rgba(30, 41, 59, 0.95);
				padding: 0.75rem 1rem;
				border-bottom: 1px solid rgba(255, 255, 255, 0.1);
				position: fixed; /* –í–ê–ñ–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: fixed –≤–º–µ—Å—Ç–æ sticky */
				top: 0;
				left: 0;
				right: 0;
				z-index: 100;
				backdrop-filter: blur(10px);
				height: 50px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç—Å—Ç—É–ø–∞ */
			}

			.mobile-header-content {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.mobile-status {
				font-size: 0.9rem;
				color: #94a3b8;
			}

			/* === –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ === */
			.main-content {
				flex: 1;
				display: flex;
				flex-direction: column;
				height: 100vh; /* –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º 100vh */
			}

			/* === –í–ò–î–ï–û –°–ï–ö–¶–ò–Ø === */
			.video-section {
				flex: 1;
				background: #000;
				position: relative;
				min-height: 40vh;
			}

			#remote-video {
				width: 100%;
				height: 100%;
				object-fit: contain;
				background: #000;
			}

			.video-placeholder {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				background: #0f172a;
				color: #94a3b8;
				text-align: center;
				padding: 2rem;
			}

			.video-placeholder i {
				font-size: 3rem;
				margin-bottom: 1rem;
			}

			.video-controls {
				position: absolute;
				bottom: 1rem;
				left: 50%;
				transform: translateX(-50%);
				display: flex;
				gap: 0.75rem;
				background: rgba(0, 0, 0, 0.7);
				padding: 0.75rem;
				border-radius: 50px;
				backdrop-filter: blur(10px);
				z-index: 50;
				opacity: 0;
				transition: opacity 0.3s ease;
				pointer-events: none;
			}

			.video-controls.visible {
				opacity: 1;
				pointer-events: auto;
			}

			.control-btn {
				width: 50px;
				height: 50px;
				border-radius: 50%;
				border: none;
				background: rgba(255, 255, 255, 0.15);
				color: white;
				font-size: 1.25rem;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: all 0.2s ease;
			}

			.control-btn:active {
				transform: scale(0.95);
				background: rgba(255, 255, 255, 0.25);
			}

			.control-btn.active {
				background: #10b981;
			}

			/* === –ß–ê–¢ –°–ï–ö–¶–ò–Ø === */
			.chat-section {
				height: 40vh;
				min-height: 250px;
				background: #1e293b;
				border-top: 1px solid rgba(255, 255, 255, 0.1);
				display: flex;
				flex-direction: column; /* –í–ê–ñ–ù–û: Flex –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
			}

			.chat-header {
				padding: 1rem;
				background: rgba(30, 41, 59, 0.95);
				border-bottom: 1px solid rgba(255, 255, 255, 0.1);
				display: flex;
				justify-content: space-between;
				align-items: center;
				flex-shrink: 0; /* –®–∞–ø–∫–∞ —á–∞—Ç–∞ –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
			}

			.chat-header h3 {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				font-size: 1rem;
			}

			.online-count {
				background: rgba(16, 185, 129, 0.2);
				color: #10b981;
				padding: 0.25rem 0.75rem;
				border-radius: 20px;
				font-size: 0.8rem;
			}

			.chat-messages {
				flex: 1; /* –í–ê–ñ–ù–û: –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ */
				overflow-y: auto; /* –í–ê–ñ–ù–û: –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∫—Ä–æ–ª–ª */
				padding: 1rem;
				display: flex;
				flex-direction: column;
				gap: 0.75rem;
				scrollbar-width: thin;
				scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
			}

			.chat-messages::-webkit-scrollbar {
				width: 6px;
			}

			.chat-messages::-webkit-scrollbar-track {
				background: transparent;
			}

			.chat-messages::-webkit-scrollbar-thumb {
				background: rgba(255, 255, 255, 0.2);
				border-radius: 3px;
			}

			.message {
				padding: 0.75rem 1rem;
				border-radius: 12px;
				word-wrap: break-word;
				animation: fadeIn 0.3s ease;
			}

			.message.system {
				background: rgba(59, 130, 246, 0.2);
				border: 1px solid rgba(59, 130, 246, 0.3);
				color: #3b82f6;
				text-align: center;
				max-width: 100%;
				font-size: 0.9rem;
				padding: 0.5rem;
			}

			.message.local {
				background: rgba(16, 185, 129, 0.2);
				border: 1px solid rgba(16, 185, 129, 0.3);
				color: #10b981;
				margin-right: 0;
			}

			.message.remote {
				background: rgba(255, 255, 255, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				color: white;
			}

			.message-sender {
				font-weight: 600;
				font-size: 0.85rem;
				margin-bottom: 0.25rem;
				opacity: 0.9;
			}

			.message-time {
				font-size: 0.75rem;
				opacity: 0.7;
				margin-top: 0.25rem;
				text-align: right;
			}

			.chat-input-area {
				padding: 1rem;
				border-top: 1px solid rgba(255, 255, 255, 0.1);
				display: flex;
				gap: 0.75rem;
				background: rgba(30, 41, 59, 0.95);
				flex-shrink: 0; /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
			}

			#chat-input {
				flex: 1;
				padding: 0.75rem 1rem;
				background: rgba(255, 255, 255, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				border-radius: 25px;
				color: white;
				font-size: 1rem;
				outline: none;
			}

			#chat-input:focus {
				border-color: #3b82f6;
			}

			.send-btn {
				width: 50px;
				height: 50px;
				border-radius: 50%;
				border: none;
				background: linear-gradient(135deg, #3b82f6, #2563eb);
				color: white;
				font-size: 1.25rem;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: all 0.2s ease;
			}

			.send-btn:active {
				transform: scale(0.95);
			}

			/* === –≠–ö–†–ê–ù –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø === */
			/* ... (–û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ, –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ) ... */

			.connect-screen {
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: #0f172a;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				padding: 2rem;
				z-index: 1000;
			}

			.connect-content {
				max-width: 400px;
				width: 100%;
				text-align: center;
			}

			.connect-icon {
				width: 80px;
				height: 80px;
				background: linear-gradient(135deg, #3b82f6, #8b5cf6);
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				margin: 0 auto 2rem;
				font-size: 2rem;
			}

			.connect-title {
				font-size: 1.75rem;
				margin-bottom: 1rem;
				background: linear-gradient(135deg, #3b82f6, #8b5cf6);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
			}

			.connect-input {
				width: 100%;
				padding: 1rem;
				margin-bottom: 1rem;
				background: rgba(255, 255, 255, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				border-radius: 12px;
				color: white;
				font-size: 1.1rem;
				text-align: center;
				text-transform: uppercase;
			}

			.connect-input::placeholder {
				color: #94a3b8;
				text-transform: none;
			}

			.connect-btn {
				width: 100%;
				padding: 1rem;
				background: linear-gradient(135deg, #3b82f6, #2563eb);
				color: white;
				border: none;
				border-radius: 12px;
				font-size: 1.1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				margin-bottom: 1rem;
			}

			.connect-btn:active {
				transform: scale(0.98);
			}

			.status-message {
				padding: 0.75rem;
				border-radius: 8px;
				margin-top: 1rem;
				font-size: 0.9rem;
			}

			.status-message.error {
				background: rgba(239, 68, 68, 0.2);
				border: 1px solid rgba(239, 68, 68, 0.3);
				color: #ef4444;
			}

			/* === –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–´–ô –†–ï–ñ–ò–ú (–ö–æ–Ω—Ç—Ä–æ–ª—ã) === */
			.fullscreen-controls {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				padding: 1rem;
				background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent);
				display: flex;
				justify-content: space-between;
				align-items: center;
				z-index: 100;

				/* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ —á–∞—Ç–∞ */
				opacity: 0.2;
				transition: opacity 0.3s ease;
				pointer-events: auto;
			}

			/* –ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞–µ–º –∏—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–∏–º—ã–º–∏ */
			.fullscreen-controls.visible {
				opacity: 1;
			}

			/* –ù–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —â–µ –º–µ–Ω—à –ø–æ–º—ñ—Ç–Ω–∏–º–∏ —É —Å—Ç–∞–Ω—ñ —Å–ø–æ–∫–æ—é */
			@media (max-width: 767px), (max-width: 1024px) and (orientation: landscape) {
				.fullscreen-controls {
					opacity: 0.1;
				}
			}

			.back-btn {
				width: 44px;
				height: 44px;
				border-radius: 50%;
				background: rgba(0, 0, 0, 0.5);
				border: none;
				color: white;
				font-size: 1.25rem;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				backdrop-filter: blur(10px);
			}

			/* === –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–û–ì–û –ß–ê–¢–ê (–í –°–¢–ò–õ–ï GTA V) === */

			/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–ª–∞–≤–∞—Ç—å –ø–æ–≤–µ—Ä—Ö –≤–∏–¥–µ–æ */
			#fullscreenChat {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				z-index: 90;
				pointer-events: none;
				display: none;
			}

			#fullscreenChat.active {
				display: block;
			}

			/* –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ (—É–∑–∫–∞—è –∫–æ–ª–æ–Ω–∫–∞ –≤ —É–≥–ª—É) */
			.fs-chat-container {
				position: absolute;
				top: 4rem;
				left: 1rem;
				width: 300px;
				max-height: 80%;

				background: rgba(0, 0, 0, 0.4);
				border-radius: 8px;
				padding: 0.5rem;
				backdrop-filter: blur(5px);

				display: flex;
				flex-direction: column;
				overflow: hidden;

				transition: transform 0.3s ease-out;
				transform: translateX(0);

				pointer-events: auto;
				justify-content: space-between;
			}

			/* –°–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç (–µ—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ –µ–≥–æ –ø—Ä—è—Ç–∞—Ç—å –∫–Ω–æ–ø–∫–æ–π) */
			.fs-chat-container.hidden {
				transform: translateX(-150%);
			}

			/* –°–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —á–∞—Ç–µ */
			.fs-chat-messages {
				flex-grow: 1;
				overflow-y: auto;
				display: flex;
				flex-direction: column;
				justify-content: flex-end;
				gap: 0.25rem;
				padding: 0.5rem 0.75rem;
				max-height: 300px;
				scrollbar-width: none;
			}

			.fs-chat-messages::-webkit-scrollbar {
				display: none;
			}

			.fs-chat-messages .message {
				padding: 0;
				border-radius: 0;
				max-width: 100%;
				margin-right: auto;

				background: transparent !important;
				border: none !important;
				color: white !important;
				font-size: 0.9rem;
			}

			.fs-chat-messages .message-sender {
				font-weight: 700;
				display: inline;
				margin-right: 0.5rem;

				color: #fca311;
			}

			.fs-chat-messages .message.local .message-sender {
				color: #10b981;
			}

			.fs-chat-messages .message-text {
				display: inline;
			}

			.fs-chat-messages .message-time,
			.fs-chat-messages .message.system {
				display: none !important;
			}

			/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ */
			.fs-chat-input-area {
				padding: 0.5rem;
				display: flex;
				gap: 0.5rem;
				border-top: 1px solid rgba(255, 255, 255, 0.1);
			}

			.fs-chat-input-area input {
				flex-grow: 1;
				padding: 0.5rem 0.75rem;
				background: rgba(255, 255, 255, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				border-radius: 4px;
				color: white;
				font-size: 0.9rem;
				outline: none;
			}

			.fs-chat-input-area .send-btn {
				width: 40px;
				height: 40px;
				font-size: 1rem;
			}

			/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–∞—Ç–∞ –∏ ID –∫–æ–º–Ω–∞—Ç—ã */
			.fs-controls-right {
				display: flex;
				align-items: center;
				gap: 1rem;
			}

			/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–∞—Ç–∞ */
			.fs-chat-toggle-btn {
				width: 44px;
				height: 44px;
				border-radius: 50%;
				background: rgba(0, 0, 0, 0.5);
				border: none;
				color: white;
				font-size: 1.25rem;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				backdrop-filter: blur(10px);
				transition: background 0.2s;
			}

			.fs-chat-toggle-btn:hover {
				background: rgba(255, 255, 255, 0.2);
			}

			.fs-chat-toggle-btn.hidden {
				display: none;
			}

			.controlls {
				display: flex;
				flex-direction: row;
				gap: 5px;
			}

			/* === –°–¢–ò–õ–¨ –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ù–ê –ö–ù–û–ü–ö–ï –ß–ê–¢–ê === */
			@keyframes pulse {
				0% {
					box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
				}
				70% {
					box-shadow: 0 0 0 10px rgba(255, 255, 255, 0);
				}
				100% {
					box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
				}
			}

			.fs-chat-toggle-btn.has-new-message {
				background: #ef4444;
				animation: pulse 1s infinite;
			}

			/* === –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ (–î–ï–°–ö–¢–û–ü) === */
			@media (min-width: 768px) {
				.desktop-header {
					display: block;
				}

				.mobile-header {
					display: none !important;
				}

				.main-content {
					flex-direction: row;
					width: 100%;
					height: 100vh; /* –í–æ–∑–≤—Ä–∞—â–∞–µ–º 100vh –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ */
					padding-top: 0; /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø, –µ—Å–ª–∏ desktop-header –Ω–µ fixed */
				}

				.video-section {
					flex: 2;
					height: calc(100vh - 60px); /* –£—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É desktop-header */
					min-height: auto;
				}

				.chat-section {
					flex: 1;
					height: calc(100vh - 60px);
					min-height: auto;
					max-width: 400px;
				}

				.video-controls {
					bottom: 2rem;
				}

				.control-btn {
					width: 56px;
					height: 56px;
					font-size: 1.5rem;
				}
			}

			/* === –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ (–ú–û–ë–ò–õ–¨–ù–´–ô –†–ï–ñ–ò–ú) === */
			@media (max-width: 767px) {
				.mobile-header {
					display: block;
				}

				.main-content {
					/* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –ó–∞–Ω–∏–º–∞–µ–º –≤—Å—é –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å, —á—Ç–æ–±—ã Flex —Ä–∞–±–æ—Ç–∞–ª –Ω–∞–¥–µ–∂–Ω–æ */
					height: auto;
					min-height: 100vh;
					position: absolute;
					top: 0;
					bottom: 0;
					left: 0;
					right: 0;
					padding-top: 50px; /* –û—Ç—Å—Ç—É–ø –æ—Ç fixed mobile-header */
					flex-direction: column;
				}

				.video-section {
					/* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ */
					height: 40vh;
					min-height: auto;
					flex-grow: 0;
					flex-shrink: 0;
				}

				#remote-video {
					width: 100%;
					height: 100%; /* –¢–µ–ø–µ—Ä—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç 40vh —Ä–æ–¥–∏—Ç–µ–ª—è */
					object-fit: contain;
				}

				.video-placeholder {
					position: absolute;
					height: auto; /* –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è */
				}

				.chat-section {
					/* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 4: –ó–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
					flex-grow: 1;
					height: auto;
					min-height: 250px;
				}

				.video-controls {
					bottom: 0.5rem;
					gap: 0.5rem;
					padding: 0.5rem;
				}

				.control-btn {
					width: 44px;
					height: 44px;
					font-size: 1.1rem;
				}

				.chat-input-area {
					padding: 0.75rem;
					flex-shrink: 0; /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
				}

				#chat-input {
					padding: 0.75rem;
					font-size: 0.95rem;
				}

				.send-btn {
					width: 44px;
					height: 44px;
					font-size: 1.1rem;
				}
			}

			/* –ú–æ–±–∏–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —á–∞—Ç–∞ */
			@media (max-width: 767px), (max-width: 1024px) and (orientation: landscape) {
				.fs-chat-container {
					top: 4.5rem;
					left: 1rem;
				}
			}

			/* === –ê–ù–ò–ú–ê–¶–ò–ò === */
			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			/* ... (–£–¢–ò–õ–ò–¢–´) ... */
			.hidden {
				display: none !important;
			}

			.loading {
				animation: pulse 1.5s infinite;
			}

			i {
				font-style: normal;
			}

			/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è touch —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
			@media (hover: none) and (pointer: coarse) {
				.control-btn,
				.send-btn,
				.back-btn {
					min-height: 44px;
					min-width: 44px;
				}

				input,
				button {
					font-size: 16px;
				}
			}

			#controlBtns {
				display: flex;
				gap: 5px;
			}
		</style>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		/>
	</head>
	<body>
		<header class="desktop-header">
			<div class="header-content">
				<div class="header-title">
					<i class="fas fa-eye"></i>
					<h2>–ü–µ—Ä–µ–≥–ª—è–¥ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó</h2>
				</div>
				<div class="room-id-display" id="desktopRoomId">‚Äî</div>
				<div class="header-status" id="desktopStatus">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</div>
			</div>
		</header>

		<header class="mobile-header hidden">
			<div class="mobile-header-content">
				<div class="mobile-status" id="mobileStatus">
					<i class="fas fa-signal"></i> –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...
				</div>
				<div class="room-id-display" id="mobileRoomId">‚Äî</div>
			</div>
		</header>

		<div id="connectScreen" class="connect-screen">
			<div class="connect-content">
				<div class="connect-icon">
					<i class="fas fa-video"></i>
				</div>
				<h1 class="connect-title">–ü–µ—Ä–µ–≥–ª—è–¥ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó</h1>
				<p style="color: #94a3b8; margin-bottom: 2rem">
					–í–≤–µ–¥—ñ—Ç—å ID –∫—ñ–º–Ω–∞—Ç–∏, —â–æ–± –ø—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó
				</p>

				<input
					type="text"
					id="roomIdInput"
					class="connect-input"
					placeholder="ID –∫—ñ–º–Ω–∞—Ç–∏"
					maxlength="10"
				/>

				<button onclick="joinRoom()" class="connect-btn">
					<i class="fas fa-play"></i> –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è
				</button>

				<div id="connectStatus" class="status-message"></div>

				<div style="margin-top: 2rem; font-size: 0.9rem; color: #64748b">
					<i class="fas fa-info-circle"></i> –ó–∞–ø–∏—Ç–∞–π—Ç–µ ID –∫—ñ–º–Ω–∞—Ç–∏ —É —Ö–æ—Å—Ç–∞
				</div>
			</div>
		</div>

		<div id="roomContent" class="main-content hidden">
			<section class="video-section">
				<video id="remote-video" autoplay playsinline></video>

				<div id="videoPlaceholder" class="video-placeholder">
					<i class="fas fa-spinner fa-spin"></i>
					<h3>–û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó...</h3>
					<p>–•–æ—Å—Ç —Å–∫–æ—Ä–æ —Ä–æ–∑–ø–æ—á–Ω–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—é</p>
				</div>

				<div class="video-controls">
					<button id="fullscreenBtn" class="control-btn" title="–ü–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–∏–π —Ä–µ–∂–∏–º">
						<i class="fas fa-expand"></i>
					</button>
					<button id="audioBtn" class="control-btn active" title="–ó–≤—É–∫ —É–≤—ñ–º–∫./–≤–∏–º–∫.">
						<i class="fas fa-volume-up"></i>
					</button>
					<button
						id="reconnectBtn"
						class="control-btn"
						title="–ü–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è"
						onclick="reconnect()"
					>
						<i class="fas fa-redo"></i>
					</button>
				</div>

				<div id="fullscreenControls" class="fullscreen-controls">
					<div id="controlBtns">
						<button class="back-btn" onclick="exitFullscreen()">
							<i class="fas fa-arrow-left"></i>
						</button>
						<button
							id="fsChatToggleBtn"
							class="fs-chat-toggle-btn"
							title="–ü–æ–∫–∞–∑–∞—Ç–∏/–°—Ö–æ–≤–∞—Ç–∏ —á–∞—Ç"
						>
							<i class="fas fa-comment"></i>
						</button>
					</div>

					<div class="fs-controls-right">
						<div class="room-id-display" id="fullscreenRoomId">‚Äî</div>
					</div>
				</div>
			</section>

			<section class="chat-section">
				<div class="chat-header">
					<h3><i class="fas fa-comments"></i> –ß–∞—Ç</h3>
					<div class="online-count" id="onlineCount">1 –æ–Ω–ª–∞–π–Ω</div>
				</div>

				<div class="chat-messages" id="messages">
					<div class="message system">
						<i class="fas fa-spinner fa-spin"></i> –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —á–∞—Ç—É...
					</div>
				</div>

				<div class="chat-input-area">
					<input
						type="text"
						id="chat-input"
						class="chat-input"
						placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."
						maxlength="500"
					/>
					<button onclick="sendMessage()" class="send-btn">
						<i class="fas fa-paper-plane"></i>
					</button>
				</div>
			</section>
		</div>

		<div id="fullscreenChat">
			<div class="fs-chat-container">
				<div class="fs-chat-messages" id="fsMessages"></div>
				<div class="fs-chat-input-area">
					<input
						type="text"
						id="fs-chat-input"
						placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."
						maxlength="500"
					/>
					<button onclick="sendFullscreenMessage()" class="send-btn">
						<i class="fas fa-paper-plane"></i>
					</button>
				</div>
			</div>
		</div>

		<div id="fullscreenChatAnchor" class="hidden"></div>

		<script src="/socket.io/socket.io.js"></script>
		<script>
			// === DOM Elements & Globals ===
			const configuration = {
				iceServers: [
					// –ü—É–±–ª–∏—á–Ω—ã–µ TURN —Å–µ—Ä–≤–µ—Ä—ã (–≤–∞–∂–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö!)
					{
						urls: "turn:openrelay.metered.ca:80",
						username: "openrelayproject",
						credential: "openrelayproject",
					},
					{
						urls: "turn:openrelay.metered.ca:443",
						username: "openrelayproject",
						credential: "openrelayproject",
					},
					{
						urls: "turn:openrelay.metered.ca:443?transport=tcp",
						username: "openrelayproject",
						credential: "openrelayproject",
					},
					{
						urls: "turn:turn.bistri.com:80",
						username: "homeo",
						credential: "homeo",
					},
					{
						urls: "turn:turn.anyfirewall.com:443?transport=tcp",
						username: "webrtc",
						credential: "webrtc",
					},
				],

				// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
				iceCandidatePoolSize: 5,
				iceTransportPolicy: "all",
				bundlePolicy: "max-bundle",
				rtcpMuxPolicy: "require",
			};
			const socket = io();
			let ROOM_ID;
			let peerConnection;
			let dataChannel;
			let HOST_ID;
			let isFullscreen = false;
			let onlineCount = 1;

			// New/Updated DOM Elements
			const videoSection = document.querySelector(".video-section");
			const fullscreenChat = document.getElementById("fullscreenChat");
			const fullscreenChatAnchor = document.getElementById("fullscreenChatAnchor");
			const fsMessagesDiv = document.getElementById("fsMessages");
			const fsChatInput = document.getElementById("fs-chat-input");
			const videoControls = document.querySelector(".video-controls"); // –ù–∏–∂–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã
			const fullscreenControls = document.getElementById("fullscreenControls"); // –í–µ—Ä—Ö–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã
			const fsChatToggleBtn = document.getElementById("fsChatToggleBtn"); // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–∞—Ç–∞

			let controlsTimeout; // –î–ª—è —Ç–∞–π–º–µ—Ä–∞ —Å–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤

			// === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ò–ù–¢–ï–†–§–ï–ô–°–ê ===

			// –í –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞ participant.html
			console.log("=== –ú–û–ë–ò–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===");
			console.log("User Agent:", navigator.userAgent);
			console.log("–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:", navigator.platform);
			console.log("–û–Ω–ª–∞–π–Ω:", navigator.onLine);
			console.log("HTTPS:", window.location.protocol === "https:");
			console.log(
				"WebRTC –ø–æ–¥–¥–µ—Ä–∂–∫–∞:",
				!!(window.RTCPeerConnection && window.RTCSessionDescription)
			);

			// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ç—å
			if (navigator.connection) {
				console.log("–¢–∏–ø —Å–µ—Ç–∏:", navigator.connection.effectiveType);
				console.log("–°–∫–æ—Ä–æ—Å—Ç—å:", navigator.connection.downlink, "Mbps");
			}

			// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–µ–∫–æ–≤
			function checkCodecSupport() {
				const video = document.createElement("video");
				const codecs = ['video/mp4; codecs="avc1.42E01E"', 'video/webm; codecs="vp8"'];

				codecs.forEach((codec) => {
					console.log(`${codec}: ${video.canPlayType(codec)}`);
				});
			}
			checkCodecSupport();

			function updateStatus(status, type = "info") {
				document.getElementById("desktopStatus").textContent = status;
				document.getElementById(
					"mobileStatus"
				).innerHTML = `<i class="fas fa-signal"></i> ${status}`;

				if (type === "error") {
					document.getElementById("mobileStatus").style.color = "#ef4444";
				} else if (type === "success") {
					document.getElementById("mobileStatus").style.color = "#10b981";
				} else {
					document.getElementById("mobileStatus").style.color = "#94a3b8";
				}
			}

			function updateRoomId(roomId) {
				document.getElementById("desktopRoomId").textContent = roomId;
				document.getElementById("mobileRoomId").textContent = roomId;
				document.getElementById("fullscreenRoomId").textContent = roomId;
			}

			function updateOnlineCount(count) {
				onlineCount = count;
				const text = count === 1 ? "1 –æ–Ω–ª–∞–π–Ω" : `${count} –æ–Ω–ª–∞–π–Ω`;
				document.getElementById("onlineCount").textContent = text;
			}

			function showRoomInterface() {
				document.getElementById("connectScreen").classList.add("hidden");
				document.getElementById("roomContent").classList.remove("hidden");
				document.querySelector(".mobile-header").classList.remove("hidden");
			}

			// --- –õ–û–ì–ò–ö–ê –ê–í–¢–û–°–ö–†–´–¢–ò–Ø –ö–û–ù–¢–†–û–õ–û–í ---

			function showControls() {
				// –í –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∏–∂–Ω—é—é –ø–∞–Ω–µ–ª—å
				if (!document.fullscreenElement) {
					videoControls.classList.add("visible");
				} else {
					// –í –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–µ –ø–∞–Ω–µ–ª–∏
					videoControls.classList.add("visible");
					fullscreenControls.classList.add("visible");
				}

				// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
				clearTimeout(controlsTimeout);

				// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä –Ω–∞ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
				controlsTimeout = setTimeout(() => {
					hideControls();
				}, 3000);
			}

			function hideControls() {
				videoControls.classList.remove("visible");
				fullscreenControls.classList.remove("visible");
			}

			// --- –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò FULLSCREEN ---

			function toggleFullscreen() {
				if (!document.fullscreenElement) {
					// *** 1. –í–•–û–î: –ü–µ—Ä–µ–º–µ—â–∞–µ–º —á–∞—Ç –≤ video-section (–¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏) ***
					videoSection.appendChild(fullscreenChat);

					if (videoSection.requestFullscreen) {
						videoSection.requestFullscreen();
					} else if (videoSection.webkitRequestFullscreen) {
						videoSection.webkitRequestFullscreen();
					} else if (videoSection.mozRequestFullScreen) {
						videoSection.mozRequestFullScreen();
					}

					fullscreenChat.classList.add("active"); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç
					copyChatMessagesToFullscreen(); // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
				} else {
					exitFullscreen();
				}
			}

			function exitFullscreen() {
				if (document.exitFullscreen) {
					document.exitFullscreen();
				} else if (document.webkitExitFullscreen) {
					document.webkitExitFullscreen();
				} else if (document.mozCancelFullScreen) {
					document.mozCancelFullScreen();
				}
				// –õ–æ–≥–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —á–∞—Ç–∞ –∏ —Å–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ 'fullscreenchange'
			}

			// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞/–≤—Ö–æ–¥–∞ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
			document.addEventListener("fullscreenchange", () => {
				isFullscreen = !!document.fullscreenElement;

				if (isFullscreen) {
					// –ü—Ä–∏ –≤—Ö–æ–¥–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
					showControls();
				} else {
					// *** 2. –í–´–•–û–î: –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∞—Ç –Ω–∞ –º–µ—Å—Ç–æ (–∫ —è–∫–æ—Ä—é) ***
					fullscreenChatAnchor.appendChild(fullscreenChat);
					fullscreenChat.classList.remove("active"); // –°–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç
					hideControls(); // –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã
				}
			});

			// *** –ù–û–í–ê–Ø/–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –ß–ê–¢–ê ***
			function toggleFullscreenChat() {
				const fsChatContainer = document.querySelector(".fs-chat-container");
				const isHidden = fsChatContainer.classList.toggle("hidden");

				// –°–Ω–∏–º–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∞—Ç–∞
				if (!isHidden) {
					fsChatToggleBtn.classList.remove("has-new-message");
					fsChatInput.focus();
				}
			}

			// === –§–£–ù–ö–¶–ò–ò –ß–ê–¢–ê ===

			function sendMessage() {
				const messageInput = document.getElementById("chat-input");
				const message = messageInput.value.trim();
				if (message === "" || !dataChannel || dataChannel.readyState !== "open") return;

				dataChannel.send(JSON.stringify({ type: "chat", message, sender: "Participant" }));
				displayMessage(message, "local", "–Ø");
				messageInput.value = "";
			}

			function sendFullscreenMessage() {
				const message = fsChatInput.value.trim();
				if (message === "" || !dataChannel || dataChannel.readyState !== "open") return;

				dataChannel.send(JSON.stringify({ type: "chat", message, sender: "Participant" }));

				// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç (–∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–æ–ø–∏—Ä—É–µ—Ç –µ–≥–æ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π)
				displayMessage(message, "local", "–Ø");

				fsChatInput.value = "";
			}

			function displayMessage(text, type, sender = "–•–æ—Å—Ç") {
				const messagesDiv = document.getElementById("messages");

				// –£–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
				const loadingMsg = messagesDiv.querySelector(".system");
				if (loadingMsg && loadingMsg.innerHTML.includes("fa-spinner")) {
					loadingMsg.remove();
				}

				const msg = document.createElement("div");
				msg.className = `message ${type}`;

				const time = new Date().toLocaleTimeString([], {
					hour: "2-digit",
					minute: "2-digit",
				});

				msg.innerHTML = `
			${type !== "system" ? `<div class="message-sender">${sender}</div>` : ""}
			<div class="message-text">${text}</div>
			<div class="message-time">${time}</div>
		`;

				messagesDiv.appendChild(msg);
				messagesDiv.scrollTop = messagesDiv.scrollHeight;

				// *** –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –í –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–´–ô –ß–ê–¢ ***
				if (fullscreenChat.classList.contains("active") && type !== "system") {
					copyMessageToFullscreen(text, type, sender);
				}
			}

			function copyMessageToFullscreen(text, type, sender) {
				const fsMsg = document.createElement("div");
				fsMsg.className = `message ${type}`;

				const senderName = type === "local" ? "–Ø" : sender;

				fsMsg.innerHTML = `
					<div class="message-sender">${senderName}:</div>
					<div class="message-text">${text}</div>
				`;

				// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10)
				if (fsMessagesDiv.children.length >= 6) {
					fsMessagesDiv.removeChild(fsMessagesDiv.children[0]);
				}

				fsMessagesDiv.appendChild(fsMsg);
				fsMessagesDiv.scrollTop = fsMessagesDiv.scrollHeight;
			}

			async function playVideo(videoElement) {
				try {
					// –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
					videoElement.setAttribute("playsinline", "true");
					videoElement.setAttribute("webkit-playsinline", "true");

					// –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
					await videoElement.play();
					console.log("‚úÖ –í–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è");

					// –°–∫—Ä—ã–≤–∞–µ–º –ª—é–±—ã–µ –æ–≤–µ—Ä–ª–µ–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
					const autoplayOverlay = document.getElementById("autoplay-overlay");
					if (autoplayOverlay) {
						autoplayOverlay.remove();
					}
				} catch (error) {
					console.warn("‚ö†Ô∏è –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:", error);

					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
					showAutoplayPrompt();
				}
			}

			function showAutoplayPrompt() {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ –æ–≤–µ—Ä–ª–µ–π
				if (document.getElementById("autoplay-overlay")) {
					return;
				}

				const overlay = document.createElement("div");
				overlay.id = "autoplay-overlay";
				overlay.style.cssText = `
					position: fixed;
					top: 0;
					left: 0;
					right: 0;
					bottom: 0;
					background: rgba(0,0,0,0.7);
					display: flex;
					flex-direction: column;
					justify-content: center;
					align-items: center;
					z-index: 10000;
					color: white;
					text-align: center;
					padding: 20px;
				`;

				overlay.innerHTML = `
					<div style="max-width: 400px; background: #1e293b; padding: 30px; border-radius: 15px;">
						<h3 style="margin-bottom: 15px; color: #3b82f6;">üé¨ –í–∫–ª—é—á–∏—Ç–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—é</h3>
						<p style="margin-bottom: 20px; color: #94a3b8;">
							–ë—Ä–∞—É–∑–µ—Ä –ø–æ—Ç—Ä–µ–±—É–≤–∞–≤ –¥–æ–∑–≤–æ–ª—É –Ω–∞ –∞–≤—Ç–æ–≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–µ–æ.
							–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± –ø–æ—á–∞—Ç–∏ –ø–µ—Ä–µ–≥–ª—è–¥.
						</p>
						<button onclick="startVideoPlayback()" style="
							background: linear-gradient(135deg, #3b82f6, #2563eb);
							color: white;
							border: none;
							padding: 15px 30px;
							border-radius: 8px;
							font-size: 16px;
							font-weight: bold;
							cursor: pointer;
							width: 100%;
						">
							‚ñ∂Ô∏è –ü–æ—á–∞—Ç–∏ –ø–µ—Ä–µ–≥–ª—è–¥
						</button>
					</div>
				`;

				document.body.appendChild(overlay);

				window.startVideoPlayback = async () => {
					const video = document.getElementById("remote-video");
					try {
						await video.play();
						overlay.remove();
						console.log("‚úÖ –í–∏–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–æ –≤—Ä—É—á–Ω—É—é");
					} catch (error) {
						console.error("‚ùå –û—à–∏–±–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:", error);
					}
				};
			}

			function copyChatMessagesToFullscreen() {
				fsMessagesDiv.innerHTML = ""; // –û—á–∏—â–∞–µ–º
				// –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ-—Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
				const mainMessages = document
					.getElementById("messages")
					.querySelectorAll(".message:not(.system)");

				mainMessages.forEach((msg) => {
					const type = msg.classList.contains("local") ? "local" : "remote";
					// –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
					const senderElement = msg.querySelector(".message-sender");
					let sender = senderElement
						? senderElement.textContent.trim()
						: type === "local"
						? "–Ø"
						: "–•–æ—Å—Ç";

					const text = msg.querySelector(".message-text")
						? msg.querySelector(".message-text").textContent
						: "...";

					copyMessageToFullscreen(text, type, sender);
				});
			}

			// === WEB RTC –ò SOCKET.IO –õ–û–ì–ò–ö–ê (–û–ë–ù–û–í–õ–ï–ù –û–ë–†–ê–ë–û–¢–ß–ò–ö dataChannel.onmessage) ===
			let pendingIceCandidates = [];

			async function createPeerConnection(hostId) {
				console.log("üì± –°–æ–∑–¥–∞–Ω–∏–µ PeerConnection –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞...");

				try {
					peerConnection = new RTCPeerConnection(configuration);
					HOST_ID = hostId;

					// === –ö–†–ò–¢–ò–ß–ù–û –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• ===

					// 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è iOS/Safari
					if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
						console.log("üçé –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –ø—Ä–∏–º–µ–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏...");

						// –î–ª—è Safari
						const video = document.getElementById("remote-video");
						video.setAttribute("playsinline", "true");
						video.setAttribute("webkit-playsinline", "true");
						video.setAttribute("x5-playsinline", "true");

						// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
						video.addEventListener("webkitbeginfullscreen", () => {
							console.log("–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º iOS");
							video.pause();
							if (video.webkitExitFullscreen) video.webkitExitFullscreen();
						});
					}

					// 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—Ä–µ–∫–æ–≤ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
					let streamTimeout;
					peerConnection.ontrack = (event) => {
						console.log("üé¨ –ü–æ–ª—É—á–µ–Ω —É–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫");

						const remoteVideo = document.getElementById("remote-video");
						if (remoteVideo.srcObject !== event.streams[0]) {
							remoteVideo.srcObject = event.streams[0];

							// –°–∫—Ä—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
							document.getElementById("videoPlaceholder").classList.add("hidden");

							// –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å —Ç–∞–π–º–∞—É—Ç–æ–º
							clearTimeout(streamTimeout);
							streamTimeout = setTimeout(() => {
								playVideoWithFallback(remoteVideo);
							}, 1000);

							updateStatus("–¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—è –∞–∫—Ç–∏–≤–Ω–∞", "success");
						}
					};

					// 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ICE —Å–æ—Å—Ç–æ—è–Ω–∏—è
					peerConnection.oniceconnectionstatechange = () => {
						console.log("üåê ICE —Å–æ—Å—Ç–æ—è–Ω–∏–µ:", peerConnection.iceConnectionState);

						switch (peerConnection.iceConnectionState) {
							case "checking":
								updateStatus("–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è...", "info");
								break;
							case "connected":
							case "completed":
								updateStatus("–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ", "success");
								// –°–∫—Ä—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
								document.getElementById("videoPlaceholder").classList.add("hidden");
								break;
							case "disconnected":
								updateStatus("–í—Ç—Ä–∞—á–µ–Ω–æ –∑–≤'—è–∑–æ–∫", "warning");
								// –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
								setTimeout(() => {
									if (peerConnection.iceConnectionState === "disconnected") {
										restartIce();
									}
								}, 3000);
								break;
							case "failed":
								updateStatus("–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è", "error");
								console.error("‚ùå ICE connection failed");

								// –ü—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
								setTimeout(() => {
									if (socket && ROOM_ID) {
										reconnect();
									}
								}, 5000);
								break;
						}
					};

					// 4. Data Channel –¥–ª—è —á–∞—Ç–∞
					peerConnection.ondatachannel = (event) => {
						dataChannel = event.channel;

						dataChannel.onopen = () => {
							console.log("‚úÖ Data Channel –æ—Ç–∫—Ä—ã—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º");
							displayMessage("–ß–∞—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ", "system");
						};

						dataChannel.onmessage = (event) => {
							try {
								const data = JSON.parse(event.data);
								if (data.type === "chat") {
									displayMessage(data.message, "remote", "–•–æ—Å—Ç");
								}
							} catch (error) {
								console.error("‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
							}
						};
					};

					// 5. ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã —Å –ª–æ–≥–∞–º–∏
					peerConnection.onicecandidate = ({ candidate }) => {
						if (candidate) {
							console.log("üì§ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç:", candidate.type, candidate.protocol);

							// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
							setTimeout(() => {
								if (socket && socket.connected) {
									socket.emit("signal", {
										roomId: ROOM_ID,
										targetId: HOST_ID,
										signalType: "ice",
										data: candidate,
									});
								}
							}, 100);
						} else {
							console.log("‚úÖ –í—Å–µ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã —Å–æ–±—Ä–∞–Ω—ã");
						}
					};

					// 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
					startConnectionMonitor();

					console.log("‚úÖ PeerConnection —Å–æ–∑–¥–∞–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞");
					return peerConnection;
				} catch (error) {
					console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è PeerConnection:", error);
					throw error;
				}
			}

			async function playVideoWithFallback(videoElement) {
				try {
					// –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–ø—ã—Ç–∫–∏
					videoElement.pause();

					// –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
					videoElement.currentTime = 0;

					// –î–ª—è iOS
					videoElement.setAttribute("playsinline", "true");
					videoElement.setAttribute("webkit-playsinline", "true");
					videoElement.muted = false; // –ü—Ä–æ–±—É–µ–º –±–µ–∑ mute

					// –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
					const playPromise = videoElement.play();

					if (playPromise !== undefined) {
						await playPromise;
						console.log("‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è");
						return true;
					}
				} catch (error) {
					console.warn("‚ö†Ô∏è –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:", error.name);

					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
					if (error.name === "NotAllowedError") {
						showMobilePlayButton();
					}

					// –ü—Ä–æ–±—É–µ–º —Å muted
					try {
						videoElement.muted = true;
						await videoElement.play();
						console.log("‚úÖ –í–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º –∑–≤—É–∫–æ–º");

						// –ü–æ–∑–≤–æ–ª—è–µ–º –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –ø–æ–∑–∂–µ
						setTimeout(() => {
							videoElement.muted = false;
						}, 1000);

						return true;
					} catch (mutedError) {
						console.error("‚ùå –î–∞–∂–µ —Å muted –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:", mutedError);
						return false;
					}
				}
			}

			function showMobilePlayButton() {
				// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å
				const oldOverlay = document.getElementById("mobile-play-overlay");
				if (oldOverlay) oldOverlay.remove();

				const overlay = document.createElement("div");
				overlay.id = "mobile-play-overlay";
				overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        padding: 20px;
    `;

				overlay.innerHTML = `
        <div style="text-align: center; max-width: 400px;">
            <div style="font-size: 60px; margin-bottom: 20px;">üé¨</div>
            <h3 style="color: white; margin-bottom: 15px;">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É</h3>
            <p style="color: #94a3b8; margin-bottom: 25px;">
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–∑–≤–æ–ª—É –Ω–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–µ–æ.
                –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± –ø–æ—á–∞—Ç–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—é.
            </p>
            <button onclick="startMobileVideo()" style="
                background: linear-gradient(135deg, #3b82f6, #2563eb);
                color: white;
                border: none;
                padding: 18px 35px;
                border-radius: 12px;
                font-size: 18px;
                font-weight: bold;
                cursor: pointer;
                width: 100%;
                box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            ">
                ‚ñ∂Ô∏è –ü–æ—á–∞—Ç–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—é
            </button>
            <p style="color: #64748b; font-size: 14px; margin-top: 15px;">
                <i>–ú–æ–∂–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –¥–≤—ñ—á—ñ –Ω–∞ –¥–µ—è–∫–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö</i>
            </p>
        </div>
    `;

				document.body.appendChild(overlay);

				// –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ tap –ø–æ –≤—Å–µ–º—É —ç–∫—Ä–∞–Ω—É
				overlay.addEventListener("click", (e) => {
					if (e.target === overlay) {
						startMobileVideo();
					}
				});
			}

			window.startMobileVideo = async () => {
				const video = document.getElementById("remote-video");
				const overlay = document.getElementById("mobile-play-overlay");

				try {
					// –ü—Ä–æ–±—É–µ–º —Å user gesture
					await video.play();

					if (overlay) {
						overlay.style.opacity = "0";
						setTimeout(() => overlay.remove(), 300);
					}

					console.log("‚úÖ –ú–æ–±–∏–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–æ –≤—Ä—É—á–Ω—É—é");
				} catch (error) {
					console.error("‚ùå –û—à–∏–±–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:", error);

					// –ü—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥
					video.muted = true;
					await video.play();

					// –ü–æ–∑–≤–æ–ª—è–µ–º –∑–≤—É–∫ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
					setTimeout(() => {
						video.muted = false;
					}, 1000);

					if (overlay) overlay.remove();
				}
			};

			function reconnect() {
				if (!socket || !ROOM_ID) {
					console.error("‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç—ã");
					return;
				}

				console.log("üîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...");
				updateStatus("–ü–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...", "info");
				displayMessage("–ü–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó...", "system");

				// –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
				if (peerConnection) {
					peerConnection.close();
					peerConnection = null;
				}

				// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
				pendingIceCandidates = [];

				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
				const placeholder = document.getElementById("videoPlaceholder");
				if (placeholder) {
					placeholder.classList.remove("hidden");
				}

				// –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
				socket.emit("join_room", ROOM_ID, (response) => {
					if (response && response.success) {
						console.log("‚úÖ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ");
					} else {
						console.error("‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:", response);
					}
				});
			}

			function restartIce() {
				if (peerConnection && typeof peerConnection.restartIce === "function") {
					console.log("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...");
					peerConnection.restartIce();
					updateStatus("–ü–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...", "info");
				}
			}
			let connectionCheckInterval;
			let lastConnectionTime = Date.now();
			let connectionMonitor;
			let lastIceState = "";

			function startConnectionMonitor() {
				if (connectionMonitor) clearInterval(connectionMonitor);

				connectionMonitor = setInterval(() => {
					if (!peerConnection) return;

					const iceState = peerConnection.iceConnectionState;
					const signalingState = peerConnection.signalingState;

					// –õ–æ–≥–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
					if (iceState !== lastIceState) {
						console.log(`üìä ICE: ${lastIceState} -> ${iceState}`);
						lastIceState = iceState;
					}

					// –ï—Å–ª–∏ –¥–æ–ª–≥–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ checking
					if (iceState === "checking") {
						const checkTime = Date.now() - connectionStartTime;
						if (checkTime > 10000) {
							// 10 —Å–µ–∫—É–Ω–¥
							console.log("‚ö†Ô∏è –î–æ–ª–≥–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ checking, –ø—Ä–æ–±—É–µ–º restartIce");
							restartIce();
						}
					}

					// –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–µ–æ
					if (iceState === "connected" || iceState === "completed") {
						const video = document.getElementById("remote-video");
						if (video && video.srcObject && video.paused) {
							console.log("üîÑ –í–∏–¥–µ–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –ø—ã—Ç–∞–µ–º—Å—è –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å...");
							playVideoWithFallback(video);
						}
					}
				}, 2000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
			}

			function reconnectStream() {
				if (socket && currentRoomId) {
					// –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
					if (peerConnection) {
						peerConnection.close();
					}

					// –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
					socket.emit("join_room", currentRoomId, (response) => {});
				}
			}

			async function handleSignal(data) {
				const { senderId, signalType, data: signalData } = data;

				console.log(`üì° –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª ${signalType} –æ—Ç ${senderId}`);

				if (signalType === "sdp" && signalData.type === "offer") {
					try {
						// –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º peerConnection
						if (!peerConnection) {
							console.log("üîÑ –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ PeerConnection...");
							peerConnection = await createPeerConnection(senderId);
						} else {
							console.log("üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ PeerConnection");
							// –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –∑–∞–∫—Ä—ã–≤–∞–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ
							if (peerConnection.signalingState !== "stable") {
								peerConnection.close();
								peerConnection = await createPeerConnection(senderId);
							}
						}

						updateStatus("–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó...");

						// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
						await peerConnection.setRemoteDescription(
							new RTCSessionDescription(signalData)
						);
						console.log("‚úÖ Remote description —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");

						// –°–æ–∑–¥–∞–µ–º –æ—Ç–≤–µ—Ç
						const answer = await peerConnection.createAnswer();
						await peerConnection.setLocalDescription(answer);
						console.log("‚úÖ Local description —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");

						// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç —Ö–æ—Å—Ç—É
						socket.emit("signal", {
							roomId: ROOM_ID,
							targetId: senderId,
							signalType: "sdp",
							data: peerConnection.localDescription,
						});
					} catch (error) {
						console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ offer:", error);

						// –ü—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
						if (peerConnection) {
							peerConnection.close();
							peerConnection = null;
						}
					}
				} else if (signalType === "ice") {
					try {
						if (peerConnection && peerConnection.remoteDescription) {
							await peerConnection.addIceCandidate(new RTCIceCandidate(signalData));
							console.log("‚úÖ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω");
						} else {
							console.log("‚ö†Ô∏è ICE –∫–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–ª—É—á–µ–Ω –¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ remote description");
							// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
							pendingIceCandidates = pendingIceCandidates || [];
							pendingIceCandidates.push(signalData);
						}
					} catch (error) {
						console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:", error);
					}
				}
			}

			function joinRoom() {
				ROOM_ID = document.getElementById("roomIdInput").value.trim().toUpperCase();
				if (!ROOM_ID) {
					showConnectError("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å ID –∫—ñ–º–Ω–∞—Ç–∏.");
					return;
				}

				updateStatus("–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...");
				socket.emit("join_room", ROOM_ID);
				showConnectStatus("–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏...");
			}

			function showConnectStatus(message) {
				const statusDiv = document.getElementById("connectStatus");
				statusDiv.textContent = message;
				statusDiv.className = "status-message";
			}

			function showConnectError(message) {
				const statusDiv = document.getElementById("connectStatus");
				statusDiv.textContent = message;
				statusDiv.className = "status-message error";
			}

			// === –ù–ê–°–¢–†–û–ô–ö–ê –°–û–ë–´–¢–ò–ô ===

			// 1. –°–æ–±—ã—Ç–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏/—Ç–∞–ø–∞ –¥–ª—è –≤–∏–¥–µ–æ —Å–µ–∫—Ü–∏–∏ (–¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤)
			videoSection.addEventListener("mousemove", showControls);
			videoSection.addEventListener("touchstart", showControls);
			videoSection.addEventListener("touchmove", showControls);

			document.getElementById("roomIdInput").addEventListener("keypress", (e) => {
				if (e.key === "Enter") joinRoom();
			});

			document.getElementById("chat-input").addEventListener("keypress", (e) => {
				if (e.key === "Enter") sendMessage();
			});

			// –ù–û–í–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–û–ì–û –ß–ê–¢–ê
			fsChatInput.addEventListener("keypress", (e) => {
				if (e.key === "Enter") sendFullscreenMessage();
			});

			// –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–û–ì–û –ß–ê–¢–ê
			fsChatToggleBtn.addEventListener("click", toggleFullscreenChat);

			document.getElementById("fullscreenBtn").addEventListener("click", toggleFullscreen);

			document.getElementById("audioBtn").addEventListener("click", () => {
				const video = document.getElementById("remote-video");
				if (video) {
					video.muted = !video.muted;
					const btn = document.getElementById("audioBtn");
					btn.classList.toggle("active", !video.muted);
					btn.innerHTML = video.muted
						? '<i class="fas fa-volume-mute"></i>'
						: '<i class="fas fa-volume-up"></i>';
				}
			});

			// === –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò SOCKET.IO ===

			socket.on("connect", () => {
				console.log("Connected to signaling server.");
			});

			socket.on("room_error", (msg) => {
				showConnectError(`–ü–æ–º–∏–ª–∫–∞: ${msg}`);
				updateStatus("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è", "error");
			});

			socket.on("room_ready", () => {
				showRoomInterface();
				updateRoomId(ROOM_ID);
				updateStatus("–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ –∫—ñ–º–Ω–∞—Ç–∏");
				updateOnlineCount(2); // –•–æ—Å—Ç + –∑—Ä–∏—Ç–µ–ª—å
				displayMessage("–í–∏ –ø—ñ–¥–∫–ª—é—á–∏–ª–∏—Å—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏", "system");
			});

			socket.on("signal", handleSignal);

			socket.on("host_disconnected", (msg) => {
				showConnectError("–•–æ—Å—Ç –≤—ñ–¥–∫–ª—é—á–∏–≤—Å—è");
				updateStatus("–•–æ—Å—Ç –≤—ñ–¥–∫–ª—é—á–∏–≤—Å—è", "error");
				displayMessage("–•–æ—Å—Ç –∑–∞–≤–µ—Ä—à–∏–≤ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—é", "system");
				setTimeout(() => {
					location.reload();
				}, 3000);
			});

			socket.on("participant_joined", () => {
				updateOnlineCount(onlineCount + 1);
				displayMessage("–ù–æ–≤–∏–π –≥–ª—è–¥–∞—á –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è", "system");
			});

			socket.on("participant_left", () => {
				updateOnlineCount(Math.max(1, onlineCount - 1));
				displayMessage("–ì–ª—è–¥–∞—á –≤–∏–π—à–æ–≤", "system");
			});

			// === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===

			// –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
			window.addEventListener("load", () => {
				const roomInput = document.getElementById("roomIdInput");
				if (roomInput) {
					roomInput.focus();

					// –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
					roomInput.addEventListener("keypress", (e) => {
						if (e.key === "Enter") {
							joinRoom();
						}
					});
				}

				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
				peerConnection = null;
				pendingIceCandidates = [];
				ROOM_ID = null;
				HOST_ID = null;

				console.log("‚úÖ –ö–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");

				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—É—é —à–∞–ø–∫—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
				if (window.innerWidth <= 767) {
					document.querySelector(".mobile-header").classList.add("hidden");
				}

				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —è–∫–æ—Ä—å —á–∞—Ç–∞ (–ø–µ—Ä–µ–º–µ—â–∞–µ–º —á–∞—Ç –≤ —è–∫–æ—Ä—å)
				fullscreenChatAnchor.appendChild(fullscreenChat);

				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ (–µ—Å–ª–∏ –Ω–µ –≤ —Ä–µ–∂–∏–º–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
				if (!document.getElementById("connectScreen").classList.contains("hidden")) {
					showControls();
				}
			});
		</script>
	</body>
</html>
